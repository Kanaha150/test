<!DOCTYPE html>
<html>

<head>
    <title>Shelf life map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lora" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.control.min.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/georaster"></script>
    <script src="https://unpkg.com/proj4"></script>
    <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>
    <script src="https://unpkg.com/chroma-js"></script>


    <style>
        body {
            padding: 0;
            margin: 0;
            background-color: "whitesmoke";
            font-family: "Noto Sans", sans-serif;
            color: #3d3d3d;
        }
        
        #title {
            position: fixed;
            margin-top: 0;
            top: 10px;
            left: 55px;
            font-size: 2em;
            font-family: "Lora", serif;
            letter-spacing: .04em;
            padding: 10px 15px;
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid grey;
            border-radius: 3px;
            z-index: 800;
        }
        
        #description h2 {
            font-family: "Lora", serif;
            letter-spacing: .04em;
        }
        
        #map {
            position: absolute;
            top: 0;
            height: 100%;
            width: 100%;
        }
        
        #description {
            position: fixed;
            bottom: 20px;
            left: 10px;
            width: 280px;
            padding: 0px 15px;
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid grey;
            border-radius: 3px;
            z-index: 800;
        }
        
        #description p {
            font-size: .9em;
            line-height: 1.5em;
        }
        
        #description a {
            color: #005daa;
            text-decoration: none;
        }
        
        #description a:hover {
            text-decoration: underline;
        }
        
        .popup {
            text-align: center;
        }
        
        .legend {
            padding: 6px 8px;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
        
        div.legend.leaflet-control br {
            clear: both;
        }
    </style>
</head>

<body>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/iso8601-js-period@0.2.1/iso8601.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/leaflet-timedimension@1.1.1/dist/leaflet.timedimension.min.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>


    <h1 id="title">Shelf life gain map</h1>
    <div id="map"></div>
    <div id="description">
        <h2>About this map</h2>
        <p>This is a part of <a href="https://yourvcca.org/india/" target="_blank">YourVCCA </a> project. The map demonstrates the shelf life gain of banana that one can get by storing in coooling in comparison to under ambient temperature n 2020. </p>
        <p>The calculations to derive the shelf life were conducted using the temperature data from ERA5.</p>
        <p>Map authored by Kanaha Shoji</p>
        <p><a href="https://github.com/GeoTIFF/georaster-layer-for-leaflet-example" target="_blank">Examples by Michael
                Dorman </a> were used to develop this web map</p>
    </div>



    </div>
    <script>
        // add OpenStreatMap basemap
        var simpleMap = L.tileLayer("https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_nolabels/{z}/{x}/{y}.png", {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attribution/">CartoDB</a>',
            subdomains: "abcd",
            maxZoom: 19
        });

        var openTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 17,
            attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)'
        });
        var stamen_Terrain = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.{ext}', {
            attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            subdomains: 'abcd',
            minZoom: 0,
            maxZoom: 18,
            ext: 'png'
        });

        // initalize leaflet map
        var map = L.map('map', {
            center: [21, 79],
            zoom: 5,
            layers: [simpleMap]
        });


        var baseMaps = {
            "Simple": simpleMap,
            "Topo": openTopoMap,
            "Terrain": stamen_Terrain
        };

        L.control.layers(baseMaps).addTo(map);


        // slider elements ///////////////////////////////////////////////
        var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']

        // add all your years here (e.g. [1982,1983,1984,1985])
        var years = [2020]

        //storing all possible times
        var timeValues = []
        for (var i in years) {
            for (var y in months) {
                timeValues.push(months[y] + "_" + years[i])
            }
        }

        // //setting max value of the slider
        // document.getElementById("slider").max = "" + timeValues.length + "";

        // //setting default label of the slider
        // document.getElementById("sliderLabel").innerHTML = timeValues[0]

        //change the prefix of the url if your images are not in the same folder as your script
        var urlPrefix = "https://kanaha150.github.io/test/images/"

        var url = []
        for (var i = 0; i < timeValues.length; i++) {
            url.push(urlPrefix + timeValues[i] + ".geojson")
        };



        // for coloring ///////////////////////////////////////////////////
        var classBreaks = [0, 2, 4, 6, 8];
        var colorHex = "Viridis";

        function pix_style(feature) {
            return {
                fillColor: getColor(feature.properties.slGainBanana2020, classBreaks, colorHex),
                weight: 0.1,
                opacity: 1,
                color: "black",
                fillOpacity: 0.5
            };
        }

        //TimeDimention elements /////////////////////////////////////////

        // Create Leaflet control object for legend
        var legend = L.control({
            position: "topright"
        });

        // Function that runs when legend is added to map
        legend.onAdd = function() {
            // Create <div> element and populate it with HTML
            var div = L.DomUtil.create('div', 'legend');
            // div.innerHTML += '<i style="background: #ffffff;"></i>0<br>';
            classBreaks.push(999); // add dummy class to extend to get last class color, chroma only returns class.length - 1 colors
            for (var i = 0; i < classBreaks.length; i++) {
                if (i + 2 === classBreaks.length) {
                    div.innerHTML += '<i style="background: ' + getColor(classBreaks[i], classBreaks, colorHex) + '"></i> ' +
                        classBreaks[i] + '+';
                    break
                } else {
                    div.innerHTML += '<i style="background: ' + getColor(classBreaks[i], classBreaks, colorHex) + '"></i> ' +
                        classBreaks[i] + '-' + classBreaks[i + 1] + '<br>';
                }
            }

            return div;

        };

        // Add Legend to Map
        legend.addTo(map);

        // get color based on map metric
        function getColor(n, classBreaks, colorHex) {
            var mapScale = chroma.scale(colorHex).classes(classBreaks);
            var regionColor = mapScale(n).hex();
            return regionColor
        }

        var controlLayers = L.control.layers().addTo(map);


        $.getJSON(url[0], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Jan 2020');
        });


        $.getJSON(url[1], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Feb 2020');
        });

        $.getJSON(url[2], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Mar 2020');
        });
        $.getJSON(url[3], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Apr 2020');
        });
        $.getJSON(url[4], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana May 2020');
        });
        $.getJSON(url[5], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Jun 2020');
        });
        $.getJSON(url[6], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Jul 2020');
        });
        $.getJSON(url[7], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Aug 2020');
        });
        $.getJSON(url[8], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Sep 2020');
        });
        $.getJSON(url[9], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Oct 2020');
        });
        $.getJSON(url[10], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Nov 2020');
        });
        $.getJSON(url[11], function(data) {
            var geojsonLayer = L.geoJSON(data, {
                style: pix_style,
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div class="popup">' +
                        "Banana shelf life gain (days)" + '<br>' +
                        '<b>' + feature.properties.slGainBanana2020 + '</b>' +
                        '</div>'
                    );
                }
            }).addTo(map);
            controlLayers.addOverlay(geojsonLayer, 'Banana Dec 2020');
        });
    </script>
</body>

</html>